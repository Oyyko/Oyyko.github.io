<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#dc143c">
<meta name="generator" content="Hexo 5.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,300italic,400,400italic,700,700italic%7CComing+Soon:300,300italic,400,400italic,700,700italic%7CJetBrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.oyyko.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.8.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="ICS笔记3">
<meta property="og:type" content="article">
<meta property="og:title" content="ICS 笔记3">
<meta property="og:url" content="https://blog.oyyko.com/2021/12/19/ICS3/index.html">
<meta property="og:site_name" content="Oyyko&#39;s Blog">
<meta property="og:description" content="ICS笔记3">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-12-18T16:00:00.000Z">
<meta property="article:modified_time" content="2021-12-19T14:10:53.530Z">
<meta property="article:author" content="Oyyko">
<meta property="article:tag" content="ICS">
<meta property="article:tag" content="Computer System">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.oyyko.com/2021/12/19/ICS3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://blog.oyyko.com/2021/12/19/ICS3/","path":"2021/12/19/ICS3/","title":"ICS 笔记3"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ICS 笔记3 | Oyyko's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Oyyko's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">29</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">19</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">39</span></a></li>
        <li class="menu-item menu-item-word"><a href="/word/" rel="section"><i class="fa fa-pen-nib fa-fw"></i>word</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#subroutine"><span class="nav-number">1.</span> <span class="nav-text">Subroutine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jsr"><span class="nav-number">2.</span> <span class="nav-text">JSR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%E5%8F%96%E8%B4%9F%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">例子：取负数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">如何使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%97%B6%E7%9A%84%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92"><span class="nav-number">5.</span> <span class="nav-text">调用时的信息传递</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#chapter8-2-memory-model-for-program-execution-the-stack"><span class="nav-number"></span> <span class="nav-text">Chapter8-2 Memory Model for Program Execution &amp; the Stack</span></a></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Oyyko"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Oyyko</p>
  <div class="site-description" itemprop="description">Internet is cool, but you cannot download love.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/oyyko" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;oyyko" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://leetcode-cn.com/oyyko" title="Leetcode → https:&#x2F;&#x2F;leetcode-cn.com&#x2F;oyyko" rel="noopener" target="_blank"><i class="fa fa-code fa-fw"></i>Leetcode</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:finalwind42@gmail.com" title="E-Mail → mailto:finalwind42@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.oyyko.com/2021/12/19/ICS3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Oyyko">
      <meta itemprop="description" content="Internet is cool, but you cannot download love.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Oyyko's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ICS 笔记3
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-19 00:00:00 / Modified: 22:10:53" itemprop="dateCreated datePublished" datetime="2021-12-19T00:00:00+08:00">2021-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ICS/" itemprop="url" rel="index"><span itemprop="name">ICS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>ICS笔记3 <span id="more"></span> ## Chapter8-1 Subroutines ### ADT Abstract Data Types Up to now, we have processed a single value * an integer * a floating point number, or * an ASCII character</p>
<p>The real world is <strong>abstract data types</strong>, or more colloquially data structures，far more complex than simple, single numbers. E.g. * a company’s organization chart * a list of items arranged in alphabetical order</p>
<p>In this chapter, we will study three abstract data types: * stacks * queues * and character strings</p>
<p>Before we get to stacks, queues, and character strings, however, we introduce a new concept that will prove very useful in manipulating data structures: <strong>subroutines, or what is also called functions</strong>.</p>
<h3 id="subroutine">Subroutine</h3>
<p>A subroutine is a program fragment that. . . * Resides in user space (i.e, not in OS) * Performs a well-defined task * Is invoked (called) multiple times by a user program * Returns control to the calling program when finished</p>
<p>Virtues: * Reuse code without re-typing it (and debugging it!) * Divide task into parts (or among multiple programmers) * Use vendor-supplied library of useful routines that one software engineer writes a program that requires such fragments and another software engineer writes the fragments. * math library * square root, sine, and arctangent,etc.</p>
<p>Important: <strong>The Call/Return Mechanism</strong> ### 相关的指令 JSR,JSRR,RET</p>
<h3 id="jsr">JSR</h3>
<p>0100 1 PCoffset11 作用：跳转，并且把之前的PC保存在R7 ### JSRR 0100 0 00 BaseR 000000 作用：根据BaseR的值跳转，并且把PC的值保存在R7 ### RET 1100 000 111 000000 作用：把R7的值赋给PC</p>
<h3 id="例子取负数">例子：取负数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Negate NOT R0,R0</span><br><span class="line">ADD R0,R0,#<span class="number">1</span></span><br><span class="line">RET </span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">; call the subroutine to compute R4=-R3</span><br><span class="line">AND R0,R0,#<span class="number">0</span> ; let R0=<span class="number">0</span></span><br><span class="line">ADD R0,R0,R3 ; let R0=R3</span><br><span class="line">JSR Negate</span><br><span class="line">AND R4,R4,#<span class="number">0</span> ; let R4=<span class="number">0</span></span><br><span class="line">ADD R4,R4,R0 </span><br></pre></td></tr></table></figure>
<h3 id="如何使用">如何使用</h3>
<p>Programmer must know * Address: or at least a label that will be bound to its address * Function: what it does * NOTE: The programmer does not need to know how the subroutine works, but what changes are visible in the machine’s state after the routine has run * Arguments: what they are and where they are placed * Return values: what they are and where they are placed</p>
<h3 id="调用时的信息传递">调用时的信息传递</h3>
<p>Argument(s) * Value passed in to a subroutine is called an argument * This is a value needed by the subroutine to do its job * Examples * TwosComp: R0 is number to be negated * OUT: R0 is character to be printed * PUTS: R0 is address of string to be printed</p>
<p>传递方法： How? In registers (simple, fast, but limited number) In memory (many, but awkward, expensive) Both</p>
<p>寄存器和内存进行传递参数</p>
<p>Return Values * A value passed out of a subroutine is called a return value * This is the value that you called the subroutine to compute</p>
<p>How? Registers, memory, or both Single return value in register most common 通常，采用寄存器保存返回值 ### caller-save and caller-save 在调用和返回的过程中势必会对寄存器产生修改，那么如何分配保存与恢复现场的责任呢？ 一般有两种办法： caller-save和callee-save 即责任在谁？ caller-save要求调用者来保存相关的寄存器的信息，并且恢复现场。 callee-save要求被调用者来存在相关的信息并且恢复现场。</p>
<p>一般都采用callee-save，只有对于函数返回值R7采用的是caller-save</p>
<p>Generally use “callee-save” strategy, except for return values Same as trap service routines Save anything that subroutine alters internally that shouldn’t be visible when the subroutine returns Restore incoming arguments to original values (unless overwritten by return value)</p>
<p>Remember <strong>You MUST save R7 if you call any other subroutine or trap</strong> Otherwise, you won’t be able to return!</p>
<h2 id="chapter8-2-memory-model-for-program-execution-the-stack">Chapter8-2 Memory Model for Program Execution &amp; the Stack</h2>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="Oyyko WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ICS/" rel="tag"><i class="fa fa-tag"></i> ICS</a>
              <a href="/tags/Computer-System/" rel="tag"><i class="fa fa-tag"></i> Computer System</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/12/16/algebra1/" rel="prev" title="代数学基础 笔记">
                  <i class="fa fa-chevron-left"></i> 代数学基础 笔记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/12/28/link1/" rel="next" title="链表 笔记">
                  链表 笔记 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-code"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Oyyko</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Oyyko/utteranc-comments","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
